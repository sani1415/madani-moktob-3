<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madani Maktab - Student Attendance Management</title>
    <link href="style.css" rel="stylesheet" type="text/css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        window.tailwind = window.tailwind || {};
        window.tailwind.config = { corePlugins: { preflight: false } };
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="header-text">
                    <h1 onclick="showSection('dashboard')" style="cursor: pointer;" title="Go to Dashboard">
                        <i class="fas fa-graduation-cap"></i> Madani Maktab
                    </h1>
                    <p>Student Attendance Management System</p>
                </div>
                <div class="language-selector">
                    <label for="languageSelector"><i class="fas fa-globe"></i></label>
                    <select id="languageSelector" onchange="changeLanguage(this.value)">
                        <option value="en">English</option>
                        <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
                    </select>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav">
        <div class="container">
            <div class="nav-container">
                <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars"></i>
                </button>
                <ul class="nav-list" id="navList">
                    <li><a href="#" onclick="showSection('dashboard', event)" class="nav-link active">
                        <i class="fas fa-home"></i> Dashboard
                    </a></li>
                    <li><a href="#" onclick="showSection('registration', event)" class="nav-link">
                        <i class="fas fa-user-plus"></i> Register Student
                    </a></li>
                    <li><a href="#" onclick="showSection('attendance', event)" class="nav-link">
                        <i class="fas fa-check-circle"></i> Daily Attendance
                    </a></li>
                    <li><a href="#" onclick="showSection('reports', event)" class="nav-link">
                        <i class="fas fa-chart-bar"></i> Reports
                    </a></li>
                    <li><a href="#" onclick="showSection('teachers', event)" class="nav-link">
                        <i class="fas fa-chalkboard-teacher"></i> Teachers Corner
                    </a></li>
                    <li><a href="#" onclick="showSection('settings', event)" class="nav-link">
                        <i class="fas fa-cog"></i> Settings
                    </a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <h2>Dashboard</h2>
                
                <!-- Holiday Notice -->
                <div id="holidayNotice" style="display: none;">
                    <!-- Holiday notice will be displayed here -->
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <h3 id="totalStudents">0</h3>
                        <p data-translate="totalStudents">Total Students</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-check"></i>
                        <h3 id="presentToday">0</h3>
                        <p data-translate="presentToday">Present Today</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-times"></i>
                        <h3 id="absentToday">0</h3>
                        <p data-translate="absentToday">Absent Today</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-percentage"></i>
                        <h3 id="attendanceRate">100%</h3>
                        <p data-translate="attendanceRate">Attendance Rate</p>
                    </div>
                    <div class="stat-card" onclick="showInactiveStudentsList()" style="cursor: pointer;">
                        <i class="fas fa-user-slash"></i>
                        <h3 id="inactiveStudents">0</h3>
                        <p data-translate="inactiveStudents">Inactive Students</p>
                    </div>
                </div>
                
                <!-- Class-wise Stats -->
                <div class="class-wise-stats">
                    <h3>Class-wise Information</h3>
                    <div id="classWiseGrid" class="class-stats-grid">
                        <!-- Class-wise statistics will be displayed here -->
                    </div>
                </div>
                <div class="recent-activity">
                    <h3>Today's Attendance Overview</h3>
                    <div id="todayOverview" class="overview-content">
                        <p>No attendance data for today yet.</p>
                    </div>
                </div>
            </section>

            <!-- Student Registration Section -->
            <section id="registration" class="section">
                <h2>Student Management</h2>
                
                <!-- Bulk Import Section (Hidden by default) -->
                <div id="bulkImportSection" class="bulk-import-section" style="display:none;">
                    <div class="bulk-import-header">
                        <h3>üìä Bulk Import Students from CSV</h3>
                        <button onclick="hideBulkImport()" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Back to List
                        </button>
                    </div>
                    
                    <div class="bulk-import-instructions">
                        <h4>üìã File Format Required:</h4>
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #2196f3;">
                            <p style="margin: 0; color: #1565c0; font-weight: 600;">
                                üí° <strong>Important for Bengali/Unicode text:</strong> Save as <strong>CSV UTF-8</strong> format
                            </p>
                            <p style="margin: 5px 0 0 0; color: #1565c0; font-size: 0.9em;">
                                <strong>Excel:</strong> File ‚Üí Save As ‚Üí Choose <strong>"CSV UTF-8 (Comma delimited) (*.csv)"</strong>
                            </p>
                            <p style="margin: 5px 0 0 0; color: #1565c0; font-size: 0.9em;">
                                <strong>Google Sheets:</strong> File ‚Üí Download ‚Üí Comma-separated values (.csv)
                            </p>
                        </div>
                        <div style="background: #fff3cd; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #ffc107;">
                            <p style="margin: 0; color: #856404; font-weight: 600;">
                                üî§ <strong>Bengali/Unicode Support:</strong> Your Bengali text will display correctly if saved as CSV UTF-8
                            </p>
                            <p style="margin: 8px 0 0 0; color: #856404; font-size: 0.9em;">
                                <strong>Example:</strong> Name should look like "‡¶Æ‡ßã‡¶π‡¶æ‡¶Æ‡ßç‡¶Æ‡¶¶ ‡¶Ü‡¶≤‡ßÄ" not "√†¬¶¬Æ√†¬ß‚Äπ√†¬¶¬π√†¬¶¬æ√†¬¶¬Æ√†¬ß√†¬¶¬Æ√†¬¶¬¶ √†¬¶‚Ä†√†¬¶¬≤√†¬ß‚Ç¨"
                            </p>
                        </div>
                        
                        <div style="text-align: center; margin-bottom: 20px;">
                            <button onclick="downloadAllStudentsCSV()" class="btn btn-secondary">
                                <i class="fas fa-download"></i> Download All Students Data
                            </button>
                        </div>
                        <div class="format-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>id</th>
                                        <th>name</th>
                                        <th>fatherName</th>
                                        <th>rollNumber</th>
                                        <th>mobileNumber</th>
                                        <th>district</th>
                                        <th>upazila</th>
                                        <th>class</th>
                                        <th>registrationDate</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>ST001</td>
                                        <td>Abdullah Rahman</td>
                                        <td>Rahman Ahmed</td>
                                        <td>101</td>
                                        <td>01711234567</td>
                                        <td>Dhaka</td>
                                        <td>Dhanmondi</td>
                                        <td>‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</td>
                                        <td>2025-01-01</td>
                                    </tr>
                                    <tr>
                                        <td>ST002</td>
                                        <td>Fatima Khatun</td>
                                        <td>Karim Uddin</td>
                                        <td>102</td>
                                        <td>01811234567</td>
                                        <td>Dhaka</td>
                                        <td>Gulshan</td>
                                        <td>‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</td>
                                        <td>2025-01-02</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="import-notes">
                            <p><strong>‚ö†Ô∏è Important:</strong></p>
                            <ul>
                                <li>First row must be headers (exactly as shown above)</li>
                                <li>All fields are required - no empty cells</li>
                                <li>Students with same ID will be replaced/updated</li>
                                <li>Roll numbers must be unique (except for updates)</li>
                                <li>Class names must match your existing classes</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="bulk-import-upload">
                        <div class="upload-area">
                            <input type="file" id="excelFile" accept=".csv" style="display:none;">
                            <div class="upload-drop-zone" onclick="document.getElementById('excelFile').click()">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Click to select CSV file</p>
                                <p class="file-types">Supports .csv files (Excel saved as CSV)</p>
                            </div>
                        </div>
                        <div class="upload-actions">
                            <button onclick="processExcelFile()" class="btn btn-primary" id="uploadBtn" disabled>
                                <i class="fas fa-upload"></i> Upload & Import Students
                            </button>
                        </div>
                    </div>
                    
                    <div id="importResults" class="import-results" style="display:none;">
                        <!-- Import results will be shown here -->
                    </div>
                </div>
                
                <!-- Students List Container -->
                <div id="studentsListContainer" class="students-management">
                    <!-- Student list will be populated here by JavaScript -->
                </div>
                
                <!-- Student Registration Form (Hidden by default) -->
                <div id="studentRegistrationForm" class="student-form-container" style="display: none;">
                    <div class="form-header">
                        <h3>Register New Student</h3>
                        <button type="button" onclick="hideStudentRegistrationForm()" class="btn btn-secondary btn-small">
                            <i class="fas fa-arrow-left"></i> Back to List
                        </button>
                    </div>
                    
                    <form id="studentForm" class="form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="studentName">Student Name *</label>
                                <input type="text" id="studentName" required>
                            </div>
                            <div class="form-group">
                                <label for="fatherName">Father's Name *</label>
                                <input type="text" id="fatherName" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="rollNumber">Roll Number *</label>
                                <input type="text" id="rollNumber" required placeholder="Enter roll number (e.g., 101, 201)">
                                <small style="color: #666; font-size: 0.8em;">Each roll number must be unique</small>
                            </div>
                            <div class="form-group">
                                <label for="studentClass">Class *</label>
                                <select id="studentClass" required>
                                    <option value="">Select Class</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="district">District *</label>
                                <input type="text" id="district" required>
                            </div>
                            <div class="form-group">
                                <label for="upazila">Sub-district (Upazila) *</label>
                                <input type="text" id="upazila" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="mobile">Mobile Number *</label>
                                <input type="tel" id="mobile" required>
                            </div>
                            <div class="form-group">
                                <!-- Empty space for form balance -->
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Register Student
                            </button>
                            <button type="button" onclick="hideStudentRegistrationForm()" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Daily Attendance Section -->
            <section id="attendance" class="section">
                <div class="attendance-header">
                    <h2><i class="fas fa-check-circle"></i> Daily Attendance</h2>
                    <div class="attendance-date-selector">
                        <input type="date" id="attendanceDate" max="">
                    </div>
                </div>

                <div class="attendance-controls">
                    <div class="class-filter">
                        <label for="classFilter">Class:</label>
                        <select id="classFilter">
                            <option value="">All Classes</option>
                        </select>
                        <span class="student-count">(<span id="filteredStudentCount">0</span> students)</span>
                    </div>
                    <div class="bulk-actions">
                        <button onclick="markAllPresent()" class="btn btn-success">
                            <i class="fas fa-check-double"></i> Mark All Present
                        </button>
                        <button onclick="showMarkAllAbsentModal()" class="btn btn-danger">
                            <i class="fas fa-user-slash"></i> Mark All Absent
                        </button>
                        <button onclick="markAllNeutral()" class="btn btn-warning">
                            <i class="fas fa-eraser"></i> <span data-translate="markAllNeutral">Clear All</span>
                        </button>
                        <button onclick="copyPreviousDayAttendance()" class="btn btn-secondary">
                            <i class="fas fa-copy"></i> Copy Previous Day
                        </button>
                    </div>
                </div>
                
                <div id="attendanceList" class="attendance-list">
                    <!-- Student attendance rows will be populated here -->
                </div>
                
                <div class="attendance-save-section">
                    <button onclick="saveAttendance()" class="btn btn-success btn-save-attendance">
                        <i class="fas fa-save"></i> Save Attendance
                    </button>
                    <p class="save-note" data-translate="rememberToSaveAttendance">Remember to save attendance after making changes!</p>
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reports" class="section">
                <h2>Attendance Reports</h2>
                
                <!-- Attendance Tracking Calendar Button -->
                <div class="calendar-toggle" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db;">
                    <button onclick="showAttendanceCalendar()" class="btn btn-info" style="margin-bottom: 10px;">
                        üìÖ <span data-translate="showAttendanceTrackingCalendar">Show Attendance Tracking Calendar</span>
                    </button>
                    <p style="font-size: 0.9rem; color: #666; margin: 0;">
                        <em>üìä <span data-translate="viewAttendanceStatistics">View which days attendance was taken vs missed this month with summary statistics</span></em>
                    </p>
                </div>
                
                <div class="report-controls">
                    <div id="dateRestrictionNotice" class="date-restriction-notice" style="display: none;">
                        <i class="fas fa-info-circle"></i>
                        <span data-translate="dateRestrictionNotice">Date selection is restricted to academic year period</span>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reportStartDate">From Date:</label>
                            <input type="date" id="reportStartDate">
                        </div>
                        <div class="form-group">
                            <label for="reportEndDate">To Date:</label>
                            <input type="date" id="reportEndDate">
                        </div>
                    </div>
                    <button onclick="generateReport()" class="btn btn-primary">
                        <i class="fas fa-chart-bar"></i> Generate Report
                    </button>
                    <button onclick="generateFromBeginningReport()" class="btn btn-success" style="margin-left: 10px;">
                        <i class="fas fa-calendar-alt"></i> From Beginning Report
                    </button>
                </div>
                <div id="reportResults" class="report-results">
                    <p data-translate="selectDateRangeToGenerate">Select date range and click "Generate Report" to view attendance data.</p>
                </div>
            </section>

            <!-- Student Detail Section -->
            <section id="student-detail" class="section">
                <div class="student-detail-header">
                    <button onclick="backToReports()" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Back to Attendance
                    </button>
                    <h2 id="studentDetailTitle">Student Details</h2>
                </div>
                <div id="studentDetailContent" class="student-detail-content">
                    <!-- Student details will be loaded here -->
                </div>
            </section>

            <!-- Teachers Corner Section (replaces Education) -->
            <section id="teachers" class="section">
                <div class="container mx-auto p-4 md:p-6">
                    <h2 id="class-dashboard-title" class="text-2xl font-bold mb-6 pb-2">Teachers Corner</h2>

                    <!-- Class Selector and Actions -->
                    <div class="bg-white p-4 rounded-lg shadow-md mb-6">
                        <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
                            <div>
                                <label for="teachersClassSelect" class="block text-sm font-medium text-gray-700 mb-1">Select Class</label>
                                <select id="teachersClassSelect" onchange="selectTeachersClass()" class="border border-gray-300 rounded-md shadow-sm p-2 min-w-[220px]">
                                    <option value="">All Classes</option>
                                </select>
                            </div>
                            <div class="flex gap-2">
                                <button id="showAddBookFormBtn" class="btn-primary text-white px-3 py-2 rounded-md text-sm font-semibold flex items-center gap-2"><i class="fas fa-plus"></i> Add New Book</button>
                                <button onclick="showDeleteAllEducationModal()" class="btn-danger text-white px-3 py-2 rounded-md text-sm font-semibold flex items-center gap-2"><i class="fas fa-trash-alt"></i> Delete All Data</button>
                            </div>
                        </div>
                    </div>

                    <!-- Today's Summary -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="stat-card"><i class="fas fa-users text-4xl text-blue-500 mb-4"></i><h3 id="class-total-students" class="text-4xl font-bold text-gray-800">0</h3><p class="text-gray-500">Total Students</p></div>
                        <div class="stat-card"><i class="fas fa-user-check text-4xl text-green-500 mb-4"></i><h3 id="class-present-today" class="text-4xl font-bold text-gray-800">0</h3><p class="text-gray-500">Present Today</p></div>
                        <div class="stat-card"><i class="fas fa-user-times text-4xl text-red-500 mb-4"></i><h3 id="class-absent-today" class="text-4xl font-bold text-gray-800">0</h3><p class="text-gray-500">Absent Today</p></div>
                        <div class="stat-card"><i class="fas fa-percentage text-4xl text-purple-500 mb-4"></i><h3 id="class-attendance-rate" class="text-4xl font-bold text-gray-800">0%</h3><p class="text-gray-500">Attendance Rate</p></div>
                    </div>

                    <!-- Dashboard Alerts -->
                    <div id="dashboard-alerts" class="mb-8 bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-4 text-gray-700 flex items-center gap-2">
                            <i class="fas fa-exclamation-triangle text-yellow-500"></i>
                            Alerts
                        </h3>
                        <div id="alerts-content" class="space-y-3"></div>
                    </div>

                    <!-- Class Overview & Teacher's Logbook -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                        <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-xl font-semibold mb-4 text-gray-700">Class Overview</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-semibold text-gray-600 text-sm mb-2">Performance</h4>
                                    <div id="performance-chart" class="space-y-3"></div>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-600 text-sm mb-2">Recent Class Logs</h4>
                                    <div id="recent-class-logs" class="space-y-2"></div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-xl font-semibold text-gray-700">Teacher Logbook</h3>
                                <button onclick="showAddLogModal()" class="btn-success text-white px-3 py-1 rounded-md text-sm font-semibold flex items-center gap-2"><i class="fas fa-plus"></i> New Note</button>
                            </div>
                            <div class="logbook-tabs border-b border-gray-200 mb-4">
                                <button onclick="switchLogTab('class')" class="tab-button py-2 px-4 text-gray-500 font-semibold active">Class Logs</button>
                                <button onclick="switchLogTab('student')" class="tab-button py-2 px-4 text-gray-500 font-semibold">Student Logs</button>
                            </div>
                            <div id="logbook-display" class="space-y-4 max-h-[200px] overflow-y-auto pr-2"></div>
                        </div>
                    </div>

                    <!-- Student List & Education Progress -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-xl font-semibold mb-4 text-gray-700">Student List</h3>
                            <div class="max-h-96 overflow-y-auto">
                                <table class="w-full text-sm text-left text-gray-600">
                                    <thead class="text-xs text-gray-700 uppercase bg-gray-50 sticky top-0">
                                        <tr>
                                            <th class="px-4 py-3 text-center">Husnul Khuluq</th>
                                            <th class="px-4 py-3">Roll</th>
                                            <th class="px-4 py-3">Name</th>
                                        </tr>
                                    </thead>
                                    <tbody id="class-student-list"></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-xl font-semibold text-gray-700">Education Progress</h3>
                                <div class="flex gap-2">
                                    <button onclick="showBookModal()" class="text-gray-500 hover:text-blue-500" title="Add new book"><i class="fas fa-plus"></i></button>
                                </div>
                            </div>
                            <div id="class-education-progress" class="space-y-4"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Modals for Teachers Corner -->
            <div id="log-modal" class="modal-backdrop justify-center items-center" style="display:none;">
                <div class="modal-content bg-white rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3">
                    <div class="p-6 border-b"><h3 id="log-modal-title" class="text-xl font-semibold text-gray-800"></h3></div>
                    <div class="p-6 space-y-4">
                        <input type="hidden" id="log-id"><input type="hidden" id="log-class-name"><input type="hidden" id="log-student-id">
                        <div>
                            <label for="log-type" class="block text-sm font-medium text-gray-700 mb-1">Note Type</label>
                            <select id="log-type" class="w-full border-gray-300 rounded-md shadow-sm"><option value="Educational">Educational</option><option value="Behavioral">Behavioral</option><option value="Parent Contact">Parent Contact</option><option value="Special Event">Special Event</option><option value="General">General</option></select>
                        </div>
                        <div class="flex items-center gap-4">
                            <label class="flex items-center gap-2"><input type="checkbox" id="log-important" class="rounded"><span class="text-sm font-medium text-gray-700">Important</span></label>
                            <label class="flex items-center gap-2"><input type="checkbox" id="log-followup" class="rounded"><span class="text-sm font-medium text-gray-700">Needs follow-up</span></label>
                        </div>
                        <div>
                            <label for="log-details" class="block text-sm font-medium text-gray-700 mb-1">Details</label>
                            <textarea id="log-details" rows="4" class="w-full border-gray-300 rounded-md shadow-sm" placeholder="Write note here..."></textarea>
                        </div>
                    </div>
                    <div class="px-6 py-4 bg-gray-50 flex justify-end gap-3"><button onclick="closeLogModal()" class="btn-secondary text-white px-4 py-2 rounded-md">Cancel</button><button onclick="saveLogEntry()" class="btn-primary text-white px-4 py-2 rounded-md">Save</button></div>
                </div>
            </div>

            <div id="student-profile-modal" class="modal-backdrop justify-center items-center" style="display:none;">
                <div class="modal-content bg-white rounded-lg shadow-xl w-11/12 md:w-2/3 lg:w-1/2">
                    <div class="p-6 border-b flex justify-between items-center">
                        <h3 id="student-profile-title" class="text-xl font-semibold text-gray-800"></h3>
                        <div>
                            <button onclick="printStudentProfile()" class="text-gray-600 hover:text-blue-500 text-sm font-semibold flex items-center gap-2 mr-4"><i class="fas fa-print"></i> Print</button>
                            <button onclick="closeStudentProfileModal()" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
                        </div>
                    </div>
                    <div id="student-profile-content" class="p-6 max-h-[70vh] overflow-y-auto"></div>
                </div>
            </div>

            <div id="book-modal" class="modal-backdrop justify-center items-center" style="display:none;">
                <div class="modal-content bg-white rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3">
                    <div class="p-6 border-b"><h3 id="book-modal-title" class="text-xl font-semibold text-gray-800"></h3></div>
                    <div class="p-6 space-y-4">
                        <input type="hidden" id="book-id">
                        <div>
                            <label for="book-name" class="block text-sm font-medium text-gray-700 mb-1">Book Name</label>
                            <input type="text" id="book-name" class="w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label for="book-total-pages" class="block text-sm font-medium text-gray-700 mb-1">Total Pages</label>
                            <input type="number" id="book-total-pages" class="w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div id="book-progress-section">
                            <label for="book-completed-pages" class="block text-sm font-medium text-gray-700 mb-1">Completed Pages</label>
                            <input type="number" id="book-completed-pages" class="w-full border-gray-300 rounded-md shadow-sm">
                            <label for="book-progress-note" class="block text-sm font-medium text-gray-700 mb-1 mt-2">Note (optional)</label>
                            <textarea id="book-progress-note" rows="2" class="w-full border-gray-300 rounded-md shadow-sm" placeholder="Write note for this update..."></textarea>
                        </div>
                        <div id="book-progress-history-section" class="pt-4 border-t">
                            <h4 class="text-sm font-semibold text-gray-600 mb-2">Progress History</h4>
                            <div id="progress-history-list" class="text-xs text-gray-500 max-h-24 overflow-y-auto space-y-1"></div>
                        </div>
                    </div>
                    <div class="px-6 py-4 bg-gray-50 flex justify-between items-center">
                        <button id="delete-book-btn" onclick="deleteBook()" class="btn-danger text-white px-4 py-2 rounded-md">Delete</button>
                        <div>
                            <button onclick="closeBookModal()" class="btn-secondary text-white px-4 py-2 rounded-md">Cancel</button>
                            <button onclick="saveBook()" class="btn-primary text-white px-4 py-2 rounded-md">Save</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="score-modal" class="modal-backdrop justify-center items-center" style="display:none;">
                <div class="modal-content bg-white rounded-lg shadow-xl w-11/12 md:w-1/2">
                    <div class="p-6 border-b"><h3 id="score-modal-title" class="text-xl font-semibold text-gray-800">Update Score</h3></div>
                    <div class="p-6 space-y-4">
                        <input type="hidden" id="score-student-id">
                        <div>
                            <label for="new-score" class="block text-sm font-medium text-gray-700 mb-1">New Score (0-100)</label>
                            <input type="number" id="new-score" min="0" max="100" class="w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label for="score-change-reason" class="block text-sm font-medium text-gray-700 mb-1">Reason (optional)</label>
                            <textarea id="score-change-reason" rows="3" class="w-full border-gray-300 rounded-md shadow-sm" placeholder="Reason for score change..."></textarea>
                        </div>
                    </div>
                    <div class="px-6 py-4 bg-gray-50 flex justify-end gap-3">
                        <button onclick="closeScoreModal()" class="btn-secondary text-white px-4 py-2 rounded-md">Cancel</button>
                        <button onclick="saveNewScore()" class="btn-primary text-white px-4 py-2 rounded-md">Save</button>
                    </div>
                </div>
            </div>



            <!-- Settings Section -->
            <section id="settings" class="section">
                <h2><i class="fas fa-cog"></i> Settings</h2>
                
                <div class="settings-tabs">
                    <button class="tab-button active" onclick="openSettingsTab(event, 'general')">
                        <i class="fas fa-cogs"></i> General
                    </button>
                    <button class="tab-button" onclick="openSettingsTab(event, 'academic')">
                        <i class="fas fa-school"></i> Academic
                    </button>
                    <button class="tab-button" onclick="openSettingsTab(event, 'books')">
                        <i class="fas fa-book"></i> Book Management
                    </button>
                    <button class="tab-button" onclick="openSettingsTab(event, 'data')">
                        <i class="fas fa-database"></i> Data Management
                    </button>
                </div>

                <!-- General Tab -->
                <div id="general" class="tab-content active">
                    <h3>Application Settings</h3>
                    <div class="setting-group">
                        <label for="appNameInput">Application Name</label>
                        <p class="help-text">Change the name displayed in the header and title.</p>
                        <div class="input-group">
                            <input type="text" id="appNameInput" value="Madani Maktab">
                            <button class="btn btn-primary" onclick="saveAppName()">
                                <i class="fas fa-save"></i> Save
                            </button>
                        </div>
                    </div>
                    
                    <h3>Hijri Date Settings</h3>
                    <div class="setting-group">
                        <label for="hijriAdjustment">Hijri Date Adjustment</label>
                        <p class="help-text">Adjust the calculated Hijri date for local moon sightings.</p>
                        <select id="hijriAdjustment" onchange="updateHijriAdjustment()">
                            <option value="0">No Adjustment (Default)</option>
                            <option value="1">+1 Day (Ahead)</option>
                            <option value="-1">-1 Day (Behind)</option>
                        </select>
                        <div class="hijri-preview" style="margin-top: 15px;">
                            <strong>Current Date Preview:</strong>
                            <div id="hijriPreview" class="hijri-date-display"></div>
                        </div>
                    </div>
                </div>

                <!-- Academic Tab -->
                <div id="academic" class="tab-content">
                    <h3>Academic Management</h3>
                    <div class="setting-group">
                        <label for="academicYearStartInput">Academic Year Start Date</label>
                        <p class="help-text">Used for reports and date restrictions.</p>
                        <div class="input-group">
                            <input type="date" id="academicYearStartInput">
                            <button class="btn btn-primary" onclick="saveAcademicYearStart()">
                                <i class="fas fa-calendar-check"></i> Set Start Date
                            </button>
                            <button class="btn btn-secondary" onclick="clearAcademicYearStart()">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                        <div id="currentAcademicYearDisplay" style="display: none; margin-top: 10px; padding: 8px; background: #e8f5e8; border-radius: 4px; color: #27ae60;">
                            <i class="fas fa-check-circle"></i>
                            <span>Current academic year starts from: <strong id="academicYearStartDisplay"></strong></span>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label for="newClassName">Manage Classes</label>
                        <p class="help-text">Add or remove classes from the system.</p>
                        <div class="input-group">
                            <input type="text" id="newClassName" placeholder="Enter new class name">
                            <button class="btn btn-primary" onclick="addClass()">
                                <i class="fas fa-plus"></i> Add Class
                            </button>
                        </div>
                        <div class="item-list" id="classesList">
                            <!-- Classes will be displayed here -->
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label>Holiday Management</label>
                        <p class="help-text">Add official holidays. Attendance cannot be taken on these days.</p>
                        <div class="input-group" style="margin-bottom: 10px;">
                            <input type="text" id="holidayName" placeholder="Holiday Name (e.g., Eid-ul-Fitr)">
                        </div>
                        <div class="input-group">
                            <input type="date" id="holidayStartDate" title="Start Date">
                            <input type="date" id="holidayEndDate" title="End Date (optional)">
                            <button class="btn btn-primary" onclick="addHoliday()">
                                <i class="fas fa-calendar-plus"></i> Add Holiday
                            </button>
                        </div>
                        <div class="item-list" id="holidaysList">
                            <!-- Holidays will be displayed here -->
                        </div>
                    </div>
                </div>
                
                <!-- Book Management Tab -->
                <div id="books" class="tab-content">
                    <h3>Book Management</h3>
                    <div class="setting-group">
                        <label for="newBookName">Add New Book</label>
                        <p class="help-text">Add books that students will study.</p>
                        <div class="input-group">
                            <input type="text" id="newBookName" placeholder="Enter new book name">
                            <select id="newBookClass">
                                <option value="">All Classes</option>
                                <!-- Class options will be populated dynamically -->
                            </select>
                            <button class="btn btn-primary" onclick="addBook()">
                                <i class="fas fa-plus"></i> Add Book
                            </button>
                        </div>
                        <div class="item-list" id="settingsBooksList">
                            <!-- Books will be displayed here -->
                        </div>
                    </div>


                </div>

                <!-- Data Management Tab -->
                <div id="data" class="tab-content">
                    <div class="danger-zone">
                        <h4><i class="fas fa-exclamation-triangle"></i> Danger Zone</h4>
                        <p>The actions below are permanent and cannot be undone. Please proceed with caution.</p>
                        <button class="btn btn-danger" onclick="showResetAttendanceModal()">
                            <i class="fas fa-trash-alt"></i> Reset Attendance History
                        </button>
                    </div>
                    
                    <div class="setting-group" style="margin-top: 25px;">
                        <label>Import / Export Data</label>
                        <p class="help-text">Manage your student data in bulk.</p>
                        <button class="btn btn-secondary" onclick="showBulkImport()">
                            <i class="fas fa-file-import"></i> Bulk Import Students
                        </button>
                        <button class="btn btn-secondary" onclick="downloadAllStudentsCSV()">
                            <i class="fas fa-file-export"></i> Export All Data
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Madani Maktab. All rights reserved.</p>
        </div>
    </footer>

    <!-- Modal for notifications -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- Bulk Absent Modal -->
    <div id="bulkAbsentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeBulkAbsentModal()">&times;</span>
            <h3>Mark All Students Absent</h3>
            <div class="bulk-absent-form">
                <label for="bulkAbsentReason">Reason for absence (applies to all students):</label>
                <input type="text" id="bulkAbsentReason" placeholder="e.g., School holiday, Strike, etc." maxlength="100">
                <div class="modal-buttons">
                    <button onclick="confirmMarkAllAbsent()" class="btn btn-danger">
                        <i class="fas fa-times-circle"></i> Mark All Absent
                    </button>
                    <button onclick="closeBulkAbsentModal()" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reset Attendance Modal -->
    <div id="resetAttendanceModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeResetAttendanceModal()">&times;</span>
            <h3 style="color: #dc3545;"><i class="fas fa-exclamation-triangle"></i> Reset Attendance History</h3>
            <div class="reset-attendance-form">
                <div style="background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 6px; padding: 15px; margin-bottom: 20px;">
                    <p style="color: #721c24; margin-bottom: 10px;"><strong>‚ö†Ô∏è Warning: This action cannot be undone!</strong></p>
                    <p style="color: #721c24; margin-bottom: 10px;">This will permanently delete:</p>
                    <ul style="color: #721c24; margin-bottom: 0;">
                        <li>All attendance records for all students</li>
                        <li>All saved attendance dates</li>
                        <li>All attendance history from the calendar</li>
                    </ul>
                </div>
                <p style="margin-bottom: 15px;">Type <strong>"RESET"</strong> to confirm:</p>
                <input type="text" id="resetConfirmationInput" placeholder="Type RESET to confirm" style="margin-bottom: 15px; width: 100%;">
                <div class="modal-buttons">
                    <button onclick="confirmResetAttendance()" class="btn btn-danger" id="confirmResetBtn" disabled>
                        <i class="fas fa-trash-alt"></i> Reset All Attendance
                    </button>
                    <button onclick="closeResetAttendanceModal()" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Book Management Edit Modal -->
    <div id="bookManagementEditModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Book</h3>
                <button type="button" onclick="closeBookManagementEditModal()" class="btn btn-secondary btn-small">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="bookManagementEditForm" class="form">
                <input type="hidden" id="bookManagementEditId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="bookManagementEditName">Book Name *</label>
                        <input type="text" id="bookManagementEditName" required>
                    </div>
                    <div class="form-group">
                        <label for="bookManagementEditClass">Class</label>
                        <select id="bookManagementEditClass">
                            <option value="">All Classes</option>
                            <option value="1">‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option>
                            <option value="2">‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option>
                            <option value="3">‡¶§‡ßÉ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option>
                            <option value="4">‡¶ö‡¶§‡ßÅ‡¶∞‡ßç‡¶• ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option>
                            <option value="5">‡¶™‡¶û‡ßç‡¶ö‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option>
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                    <button type="button" onclick="closeBookManagementEditModal()" class="btn btn-secondary">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script type="module" src="translations.js"></script>
    <script src="modules/hijri.js" type="module"></script>
    <script type="module" src="modules/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // If Teachers Corner is visible at load, initialize it
            const teachersSection = document.getElementById('teachers');
            if (teachersSection && teachersSection.classList.contains('active') && typeof showTeachersCorner === 'function') {
                showTeachersCorner();
            }
        });
    </script>
</body>
</html>
