<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Loading... - Student Management System</title>
    <link href="style.css" rel="stylesheet" type="text/css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Load app name immediately to prevent flash on loading screen
        (async function() {
            let appName = 'Loading...'; // Show loading state instead of hardcoded name
            
            try {
                const response = await fetch('/api/settings/appName');
                if (response.ok) {
                    const data = await response.json();
                    appName = data.value || 'Student Management System'; // Generic fallback
                } else {
                    // Try localStorage as backup
                    appName = localStorage.getItem('madaniMaktabAppName') || 'Student Management System';
                }
            } catch (error) {
                console.log('Using fallback app name');
                appName = localStorage.getItem('madaniMaktabAppName') || 'Student Management System';
            }
            
            // Update loading screen elements immediately
            const loadingAppName = document.getElementById('loadingAppName');
            if (loadingAppName) {
                loadingAppName.textContent = appName;
            }
            
            // Update page title
            const pageTitle = document.getElementById('pageTitle');
            if (pageTitle) {
                        pageTitle.textContent = `${appName} - Student Management System`;
            }
            
            // Save to localStorage for consistency
            localStorage.setItem('madaniMaktabAppName', appName);
        })();
    </script>
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        color: white;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    ">
        <div style="text-align: center;">
            <div style="
                width: 60px;
                height: 60px;
                border: 4px solid rgba(255,255,255,0.3);
                border-radius: 50%;
                border-top-color: white;
                animation: spin 1s ease-in-out infinite;
                margin: 0 auto 20px;
            "></div>
            <h2 style="margin: 0 0 10px 0; font-size: 24px; font-weight: 300;">
                <i class="fas fa-graduation-cap"></i> <span id="loadingAppName">Loading...</span>
            </h2>
            <p style="margin: 0; font-size: 16px; opacity: 0.8;">
                Loading your dashboard...
            </p>
        </div>
    </div>
    
    <!-- Main Application Content (hidden initially) -->
    <div id="mainAppContent" style="display: none;">
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="header-text">
                    <h1 onclick="showSection('dashboard')" style="cursor: pointer;" title="Go to Dashboard">
                        <i class="fas fa-graduation-cap"></i> <span id="headerAppName">Loading...</span>
                    </h1>
                    <p>Student Management System</p>
                </div>
                <div class="header-controls">
                    <div class="language-selector">
                        <label for="languageSelector"><i class="fas fa-globe"></i></label>
                        <select id="languageSelector" onchange="changeLanguage(this.value)">
                            <option value="en">English</option>
                            <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
                        </select>
                    </div>
                    <div class="user-info">
                        <span id="currentUser" style="margin-right: 15px; color: #fff; font-weight: 500;"></span>
                        <button onclick="logout()" class="logout-btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 14px;">
                            <i class="fas fa-sign-out-alt"></i> <span data-translate="logout">Logout</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav">
        <div class="container">
            <div class="nav-container">
                <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars"></i>
                </button>
                <ul class="nav-list" id="navList">
                    <li class="admin-only"><a href="#" onclick="showSection('dashboard', event)" class="nav-link">
                        <i class="fas fa-home"></i> Dashboard
                    </a></li>
                    <li class="admin-only"><a href="#" onclick="showSection('registration', event)" class="nav-link">
                        <i class="fas fa-user-plus"></i> Register Student
                    </a></li>
                    <li class="admin-only"><a href="#" onclick="showSection('attendance', event)" class="nav-link">
                        <i class="fas fa-check-circle"></i> Daily Attendance
                    </a></li>
                    <li class="admin-only"><a href="#" onclick="showSection('reports', event)" class="nav-link">
                        <i class="fas fa-chart-bar"></i> Reports
                    </a></li>
                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" onclick="toggleTeachersCornerDropdown()">
                            <i class="fas fa-chalkboard-teacher"></i> Teachers Corner <i class="fas fa-chevron-down"></i>
                        </a>
                        <div id="teachersCornerDropdown" class="dropdown-menu" style="display: none;">
                            <!-- Class options will be populated dynamically -->
                        </div>
                    </li>
                    <li class="admin-only"><a href="#" onclick="showSection('settings', event)" class="nav-link">
                        <i class="fas fa-cog"></i> Settings
                    </a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section">
                <h2>Dashboard</h2>
                
                <!-- Holiday Notice -->
                <div id="holidayNotice" style="display: none;">
                    <!-- Holiday notice will be displayed here -->
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <h3 id="totalStudents">0</h3>
                        <p data-translate="totalStudents">Total Students</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-check"></i>
                        <h3 id="presentToday">0</h3>
                        <p data-translate="presentToday">Present Today</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-times"></i>
                        <h3 id="absentToday">0</h3>
                        <p data-translate="absentToday">Absent Today</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-percentage"></i>
                        <h3 id="attendanceRate">100%</h3>
                        <p data-translate="attendanceRate">Attendance Rate</p>
                    </div>
                    <div class="stat-card" onclick="showInactiveStudentsList()" style="cursor: pointer;">
                        <i class="fas fa-user-slash"></i>
                        <h3 id="inactiveStudents">0</h3>
                        <p data-translate="inactiveStudents">Inactive Students</p>
                    </div>
                    <div class="stat-card performance-card">
                        <i class="fas fa-star"></i>
                        <div class="performance-tiers">
                            <div class="tier mustaid">
                                <span class="tier-count" id="mustaidCount">0</span>
                                <span class="tier-label" data-translate="mustaid">Mustaid</span>
                            </div>
                            <div class="tier mutawassit">
                                <span class="tier-count" id="mutawassitCount">0</span>
                                <span class="tier-label" data-translate="mutawassit">Mutawassit</span>
                            </div>
                            <div class="tier mujtahid">
                                <span class="tier-count" id="mujtahidCount">0</span>
                                <span class="tier-label" data-translate="mujtahid">Mujtahid</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Main Dashboard Alerts -->
                <div id="main-dashboard-alerts" class="dashboard-alerts-section" style="display: none;">
                    <h3><i class="fas fa-exclamation-triangle"></i> <span data-translate="institution_alerts">Institution Alerts</span></h3>
                    <div id="main-alerts-content" class="alerts-content">
                        <!-- Alerts will be rendered here -->
                    </div>
                </div>
                
                <!-- Class-wise Stats -->
                <div class="class-wise-stats">
                    <h3><span data-translate="class_wise_information">Class-wise Information</span></h3>
                    <div class="class-stats-table-container">
                        <div id="classStatsLoading" class="loading-indicator">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span data-translate="loading_class_statistics">Loading class statistics...</span>
                        </div>
                        <table class="class-stats-table" id="classStatsTable" style="display: none;">
                            <thead>
                                <tr>
                                    <th data-translate="class">Class</th>
                                    <th data-translate="total">Total</th>
                                    <th data-translate="present">Present</th>
                                    <th data-translate="absent">Absent</th>
                                    <th data-translate="rate">Rate</th>
                                    <th data-translate="inactive">Inactive</th>
                                    <th data-translate="avg_score">Avg Score</th>
                                    <th data-translate="mustaid">Mustaid</th>
                                    <th data-translate="mutawassit">Mutawassit</th>
                                    <th data-translate="mujtahid">Mujtahid</th>
                                </tr>
                            </thead>
                            <tbody id="classWiseTableBody">
                                <!-- Class-wise statistics will be displayed here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Student Registration Section -->
            <section id="registration" class="section">
                <h2>Student Management</h2>
                
                
                <!-- Students List Container -->
                <div id="studentsListContainer" class="students-management">
                    <!-- Student list will be populated here by JavaScript -->
                </div>
                
                <!-- Student Registration Form (Hidden by default) -->
                <div id="studentRegistrationForm" class="student-form-container" style="display: none;">
                    <div class="form-header">
                        <h3>Register New Student</h3>
                        <button type="button" onclick="hideStudentRegistrationForm()" class="btn btn-secondary btn-small">
                            <i class="fas fa-arrow-left"></i> Back to List
                        </button>
                    </div>
                    
                    <form id="studentForm" class="form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="studentName">Student Name *</label>
                                <input type="text" id="studentName" required>
                            </div>
                            <div class="form-group">
                                <label for="fatherName">Father's Name *</label>
                                <input type="text" id="fatherName" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="rollNumber">Roll Number *</label>
                                <input type="text" id="rollNumber" required placeholder="">
                                <small style="color: #666; font-size: 0.8em;">Each roll number must be unique</small>
                            </div>
                            <div class="form-group">
                                <label for="studentClass">Class *</label>
                                <select id="studentClass" required>
                                    <option value="">Select Class</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="district">District *</label>
                                <input type="text" id="district" required>
                            </div>
                            <div class="form-group">
                                <label for="upazila">Sub-district (Upazila) *</label>
                                <input type="text" id="upazila" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="mobile">Mobile Number *</label>
                                <input type="tel" id="mobile" required>
                            </div>
                            <div class="form-group">
                                <!-- Empty space for form balance -->
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Register Student
                            </button>
                            <button type="button" onclick="hideStudentRegistrationForm()" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Daily Attendance Section -->
            <section id="attendance" class="section">
                <div class="attendance-header">
                    <h2><i class="fas fa-check-circle"></i> Daily Attendance</h2>
                    <div class="attendance-date-selector">
                        <input type="date" id="attendanceDate" max="">
                    </div>
                </div>

                <div class="attendance-controls">
                    <div class="class-filter">
                        <label for="classFilter">Class:</label>
                        <select id="classFilter">
                            <option value="">All Classes</option>
                        </select>
                        <button onclick="resetAttendanceClassFilter()" class="btn btn-sm btn-secondary" title="Reset to All Classes" style="margin-left: 5px; padding: 2px 8px; font-size: 0.8rem;">
                            <i class="fas fa-undo"></i>
                        </button>
                        <span class="student-count">(<span id="filteredStudentCount">0</span> students)</span>
                    </div>
                    <div class="bulk-actions">
                        <button onclick="markAllPresent()" class="btn btn-success btn-sm">
                            <i class="fas fa-check-double"></i> <span data-translate="markAllPresent">Mark All Present</span>
                        </button>
                        <button onclick="showMarkAllAbsentModal()" class="btn btn-danger btn-sm">
                            <i class="fas fa-user-slash"></i> <span data-translate="markAllAbsent">Mark All Absent</span>
                        </button>
                        <button onclick="markAllNeutral()" class="btn btn-warning btn-sm">
                            <i class="fas fa-eraser"></i> <span data-translate="markAllNeutral">Clear All</span>
                        </button>
                        <button onclick="copyPreviousDayAttendance()" class="btn btn-secondary btn-sm">
                            <i class="fas fa-copy"></i> <span data-translate="copyPreviousDay">Copy Previous Day</span>
                        </button>
                        <button onclick="saveAttendance()" class="btn btn-primary btn-sm btn-save-attendance">
                            <i class="fas fa-save"></i> Save Attendance
                        </button>
                    </div>
                </div>
                
                <div id="attendanceList" class="attendance-list">
                    <!-- Student attendance rows will be populated here -->
                </div>
                
            </section>

            <!-- Reports Section -->
            <section id="reports" class="section">
                <h2>Attendance Reports</h2>
                
                <!-- Attendance Tracking Calendar Button -->
                <div class="calendar-toggle" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db;">
                    <button onclick="showAttendanceCalendar()" class="btn btn-info" style="margin-bottom: 10px;">
                        üìÖ <span data-translate="showAttendanceTrackingCalendar">Show Attendance Tracking Calendar</span>
                    </button>
                    <p style="font-size: 0.9rem; color: #666; margin: 0;">
                        <em>üìä <span data-translate="viewAttendanceStatistics">View which days attendance was taken vs missed this month with summary statistics</span></em>
                    </p>
                </div>
                
                <div class="report-controls">
                    <div id="dateRestrictionNotice" class="date-restriction-notice" style="display: none;">
                        <i class="fas fa-info-circle"></i>
                        <span data-translate="dateRestrictionNotice">Date selection is restricted to academic year period</span>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reportStartDate">From Date:</label>
                            <input type="date" id="reportStartDate">
                        </div>
                        <div class="form-group">
                            <label for="reportEndDate">To Date:</label>
                            <input type="date" id="reportEndDate">
                        </div>
                    </div>
                    <button onclick="generateReport()" class="btn btn-primary">
                        <i class="fas fa-chart-bar"></i> Generate Report
                    </button>
                    <button onclick="generateFromBeginningReport()" class="btn btn-success" style="margin-left: 10px;">
                        <i class="fas fa-calendar-alt"></i> <span data-translate="fromBeginningReport">From Beginning Report</span>
                    </button>
                </div>
                <div id="reportResults" class="report-results">
                    <p data-translate="selectDateRangeToGenerate">Select date range and click "Generate Report" to view attendance data.</p>
                </div>
            </section>



            <!-- Teachers Corner Section -->
            <section id="teachers-corner-section" class="section">
                <h2 id="class-dashboard-title" class="text-2xl font-bold mb-6 pb-2"></h2>
    
                <!-- Today's Summary -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
                    <div class="stat-card"><i class="fas fa-users text-4xl text-blue-500 mb-4"></i><h3 id="class-total-students" class="text-4xl font-bold text-gray-800">0</h3><p class="text-gray-500">‡¶Æ‡ßã‡¶ü ‡¶õ‡¶æ‡¶§‡ßç‡¶∞</p></div>
                    <div class="stat-card"><i class="fas fa-user-check text-4xl text-green-500 mb-4"></i><h3 id="class-present-today" class="text-4xl font-bold text-gray-800">0</h3><p class="text-gray-500">‡¶Ü‡¶ú ‡¶â‡¶™‡¶∏‡ßç‡¶•‡¶ø‡¶§</p></div>
                    <div class="stat-card"><i class="fas fa-user-times text-4xl text-red-500 mb-4"></i><h3 id="class-absent-today" class="text-4xl font-bold text-gray-800">0</h3><p class="text-gray-500">‡¶Ü‡¶ú ‡¶Ö‡¶®‡ßÅ‡¶™‡¶∏‡ßç‡¶•‡¶ø‡¶§</p></div>
                    <div class="stat-card"><i class="fas fa-percentage text-4xl text-purple-500 mb-4"></i><h3 id="class-attendance-rate" class="text-4xl font-bold text-gray-800">0%</h3><p class="text-gray-500">‡¶â‡¶™‡¶∏‡ßç‡¶•‡¶ø‡¶§‡¶ø‡¶∞ ‡¶π‡¶æ‡¶∞</p></div>
                    <div class="stat-card" onclick="showInactiveStudentsModal()" style="cursor: pointer;"><i class="fas fa-user-slash text-4xl text-orange-500 mb-4"></i><h3 id="class-inactive-students" class="text-4xl font-bold text-gray-800">0</h3><p class="text-gray-500">‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶õ‡¶æ‡¶§‡ßç‡¶∞</p></div>
                </div>
    
                <!-- Dashboard Alerts -->
                <div id="dashboard-alerts" class="mb-8 bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold mb-4 text-gray-700 flex items-center gap-2">
                        <i class="fas fa-exclamation-triangle text-yellow-500"></i>
                        ‡¶è‡¶ï ‡¶®‡¶ú‡¶∞‡ßá ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ
                    </h3>
                    <div id="alerts-content" class="space-y-3">
                        <!-- Alerts will be rendered here -->
                    </div>
                </div>
    
                <!-- Class Overview & Teacher's Logbook -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                    <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                         <h3 class="text-xl font-semibold mb-4 text-gray-700">‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ‡¶∞ ‡¶∏‡¶æ‡¶∞‡ßç‡¶¨‡¶ø‡¶ï ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</h3>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                       <div>
                                  <h4 class="font-semibold text-gray-600 text-sm mb-2">‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡¶¶‡ßá‡¶∞ ‡¶∏‡ßç‡¶§‡¶∞</h4>
                                  <div id="performance-chart" class="space-y-3">
                                      <!-- Performance categories will be rendered here -->
                                  </div>
                              </div>
                             <div>
                                 <h4 class="font-semibold text-gray-600 text-sm mb-2">‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶≤‡¶ó</h4>
                                 <div id="recent-class-logs" class="space-y-2">
                                     <!-- Recent logs will be rendered here -->
                                 </div>
                             </div>
                         </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold text-gray-700">üìî ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï‡ßá‡¶∞ ‡¶≤‡¶ó‡¶¨‡ßÅ‡¶ï</h3>
                            <button onclick="showAddLogModal()" class="btn-success text-white px-3 py-1 rounded-md text-sm font-semibold flex items-center gap-2"><i class="fas fa-plus"></i> ‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡ßã‡¶ü</button>
                        </div>
                        <div class="logbook-tabs border-b border-gray-200 mb-4">
                            <button onclick="switchLogTab('class')" class="tab-button py-2 px-4 text-gray-500 font-semibold active">‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶≤‡¶ó</button>
                            <button onclick="switchLogTab('student')" class="tab-button py-2 px-4 text-gray-500 font-semibold">‡¶õ‡¶æ‡¶§‡ßç‡¶∞ ‡¶≤‡¶ó</button>
                        </div>
                        <div id="logbook-display" class="space-y-4 max-h-[200px] overflow-y-auto pr-2"></div>
                    </div>
                </div>
    
                <!-- Student List & Education Progress -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold text-gray-700">‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
                            <button onclick="clearStudentFilter()" class="text-sm text-blue-600 hover:text-blue-800 underline">
                                ‡¶∏‡¶¨ ‡¶õ‡¶æ‡¶§‡ßç‡¶∞ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                            </button>
                        </div>
                        <div class="max-h-96 overflow-y-auto student-list-container">
                            <table class="w-full text-sm text-left text-gray-600">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50 sticky top-0">
                                    <tr>
                                        <th class="px-4 py-3 text-center">‡¶π‡ßÅ‡¶∏‡¶®‡ßÅ‡¶≤ ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶ï</th>
                                        <th class="px-4 py-3">‡¶∞‡ßã‡¶≤</th>
                                        <th class="px-4 py-3">‡¶®‡¶æ‡¶Æ</th>
                                    </tr>
                                </thead>
                                <tbody id="class-student-list"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold text-gray-700">‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø</h3>
                            <div class="flex gap-2">
                                <button onclick="showBookModal()" class="text-gray-500 hover:text-blue-500" title="‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶á ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®"><i class="fas fa-plus"></i></button>
                            </div>
                        </div>
                        <div id="class-education-progress" class="space-y-4"></div>
                    </div>
                    
                    <!-- Progress History Summary -->
                    <div class="bg-white p-6 rounded-lg shadow-md mt-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold text-gray-700">‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™</h3>
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-chart-line mr-1"></i>‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ‡¶∞ ‡¶∏‡¶æ‡¶Æ‡¶ó‡ßç‡¶∞‡¶ø‡¶ï ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø
                            </div>
                        </div>
                        <div id="progress-summary" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <!-- Progress summary will be populated here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings" class="section">
                <h2><i class="fas fa-cog"></i> Settings</h2>
                
                <div class="settings-tabs">
                    <button class="tab-button active" onclick="openSettingsTab(event, 'general')">
                        <i class="fas fa-cogs"></i> <span data-translate="general">General</span>
                    </button>
                    <button class="tab-button" onclick="openSettingsTab(event, 'academic')">
                        <i class="fas fa-school"></i> <span data-translate="academic">Academic</span>
                    </button>
                    <button class="tab-button" onclick="openSettingsTab(event, 'books')">
                        <i class="fas fa-book"></i> <span data-translate="bookManagement">Book Management</span>
                    </button>
                    <button class="tab-button" onclick="openSettingsTab(event, 'alerts')">
                        <i class="fas fa-exclamation-triangle"></i> <span data-translate="alerts">Alerts</span>
                    </button>
                    <button class="tab-button" onclick="openSettingsTab(event, 'data')">
                        <i class="fas fa-database"></i> <span data-translate="dataManagement">Data Management</span>
                    </button>
                    <button class="tab-button" onclick="openSettingsTab(event, 'users')">
                        <i class="fas fa-users"></i> <span data-translate="userManagement">User Management</span>
                    </button>
                </div>

                <!-- General Tab -->
                <div id="general" class="tab-content active">
                    <h3>Application Settings</h3>
                    <div class="setting-group">
                        <label for="appNameInput">Application Name</label>
                        <p class="help-text" data-translate="appNameDescription">Change the name displayed in the header and title.</p>
                        <div class="input-group">
                            <input type="text" id="appNameInput" value="" placeholder="Enter application name">
                            <button class="btn btn-primary" onclick="saveAppName()">
                                <i class="fas fa-save"></i> Save
                            </button>
                        </div>
                    </div>
                    
                    <h3>Hijri Date Settings</h3>
                    <div class="setting-group">
                        <label for="hijriAdjustment" data-translate="hijriDateAdjustment">Hijri Date Adjustment</label>
                        <p class="help-text" data-translate="hijriDateAdjustmentDesc">Adjust the calculated Hijri date for local moon sightings.</p>
                        <select id="hijriAdjustment" onchange="updateHijriAdjustment()">
                            <option value="0">No Adjustment (Default)</option>
                            <option value="1">+1 <span data-translate="day">Day</span> (<span data-translate="ahead">Ahead</span>)</option>
                            <option value="-1">-1 <span data-translate="day">Day</span> (<span data-translate="behind">Behind</span>)</option>
                        </select>
                        <div class="hijri-preview" style="margin-top: 15px;">
                            <strong data-translate="currentDatePreview">Current Date Preview:</strong>
                            <div id="hijriPreview" class="hijri-date-display"></div>
                        </div>
                    </div>
                </div>

                <!-- Academic Tab -->
                <div id="academic" class="tab-content">
                    <h3>Academic Management</h3>
                    <div class="setting-group">
                        <label for="academicYearStartInput">Academic Year Start Date</label>
                        <p class="help-text">Used for reports and date restrictions.</p>
                        <div class="input-group">
                            <input type="date" id="academicYearStartInput">
                            <button class="btn btn-primary" onclick="saveAcademicYearStart()">
                                <i class="fas fa-calendar-check"></i> Set Start Date
                            </button>
                            <button class="btn btn-secondary" onclick="clearAcademicYearStart()">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                        <div id="currentAcademicYearDisplay" style="display: none; margin-top: 10px; padding: 8px; background: #e8f5e8; border-radius: 4px; color: #27ae60;">
                            <i class="fas fa-check-circle"></i>
                            <span>Current academic year starts from: <strong id="academicYearStartDisplay"></strong></span>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label for="newClassName">Manage Classes</label>
                        <p class="help-text">Add or remove classes from the system.</p>
                        <div class="input-group">
                            <input type="text" id="newClassName" placeholder="Enter new class name">
                            <button class="btn btn-primary" onclick="addClass()">
                                <i class="fas fa-plus"></i> Add Class
                            </button>
                        </div>
                        <div class="item-list" id="classesList">
                            <!-- Classes will be displayed here -->
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label>Holiday Management</label>
                        <p class="help-text">Add official holidays. Attendance cannot be taken on these days.</p>
                        <div class="input-group" style="margin-bottom: 10px;">
                            <input type="text" id="holidayName" placeholder="Holiday Name (e.g., Eid-ul-Fitr)">
                        </div>
                        <div class="input-group">
                            <input type="date" id="holidayStartDate" title="Start Date">
                            <input type="date" id="holidayEndDate" title="End Date (optional)">
                            <button class="btn btn-primary" onclick="addHoliday()">
                                <i class="fas fa-calendar-plus"></i> Add Holiday
                            </button>
                        </div>
                        <div class="item-list" id="holidaysList">
                            <!-- Holidays will be displayed here -->
                        </div>
                    </div>
                </div>
                
                <!-- Book Management Tab -->
                <div id="books" class="tab-content">
                    <h3>Book Management</h3>
                    <div class="setting-group">
                        <label for="newBookName">Add New Book</label>
                        <p class="help-text">Add books that students will study.</p>
                        <div class="input-group">
                            <input type="text" id="newBookName" placeholder="Enter new book name">
                            <select id="newBookClass">
                                <option value="">All Classes</option>
                                <!-- Class options will be populated dynamically -->
                            </select>
                            <input type="number" id="newBookPages" placeholder="Total pages" min="1" style="width: 120px;">
                            <button class="btn btn-primary" onclick="addBook()">
                                <i class="fas fa-plus"></i> Add Book
                            </button>
                        </div>
                        <div class="item-list" id="settingsBooksList">
                            <!-- Books will be displayed here -->
                        </div>
                        
                        <!-- Book List Display -->
                        <div class="setting-group" style="margin-top: 25px;">
                            <h4>Manage Existing Books</h4>
                            <div id="booksList">
                                <!-- Books will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                

                <!-- Alerts Tab -->
                <div id="alerts" class="tab-content">
                    <h3>Alert System Settings</h3>
                    <div class="setting-group">
                        <label for="lowScoreThreshold">Low Score Alert Threshold</label>
                        <p class="help-text">Set the minimum score below which students will be flagged in the class dashboard alerts.</p>
                        <div class="input-group">
                            <input type="number" id="lowScoreThreshold" min="0" max="100" value="60">
                            <button class="btn btn-primary" onclick="saveAlertThreshold()">
                                <i class="fas fa-save"></i> Save
                            </button>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label for="criticalScoreThreshold">Critical Score Alert Threshold</label>
                        <p class="help-text">Set the critical score below which students will be flagged with high priority alerts.</p>
                        <div class="input-group">
                            <input type="number" id="criticalScoreThreshold" min="0" max="100" value="50">
                            <button class="btn btn-primary" onclick="saveAlertThreshold()">
                                <i class="fas fa-save"></i> Save
                            </button>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label for="lowClassAverageThreshold">Low Class Average Threshold</label>
                        <p class="help-text">Set the minimum class average score below which the entire class will be flagged.</p>
                        <div class="input-group">
                            <input type="number" id="lowClassAverageThreshold" min="0" max="100" value="70">
                            <button class="btn btn-primary" onclick="saveAlertThreshold()">
                                <i class="fas fa-save"></i> Save
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Data Management Tab -->
                <div id="data" class="tab-content">
                    <h3><i class="fas fa-database"></i> Data Management</h3>
                    
                    <!-- Reset Options List -->
                    <div class="reset-list">
                        <div class="reset-category">
                            <h4><i class="fas fa-user-graduate"></i> Student Data</h4>
                            <div class="reset-items">
                                <div class="reset-item">
                                    <span class="reset-label">Delete All Students</span>
                                    <span class="reset-description">Permanently delete all student information, attendance, scores, and progress</span>
                                    <button class="btn btn-danger btn-sm" onclick="showResetStudentsModal()">
                                        <i class="fas fa-trash-alt"></i> Delete
                                    </button>
                                </div>
                                <div class="reset-item">
                                    <span class="reset-label">Reset All Scores</span>
                                    <span class="reset-description">Clear all student scores to default values</span>
                                    <button class="btn btn-warning btn-sm" onclick="showResetScoresModal()">
                                        <i class="fas fa-chart-line"></i> Reset
                                    </button>
                                </div>
                                <div class="reset-item">
                                    <span class="reset-label">Reset Education Progress</span>
                                    <span class="reset-description">Delete all education progress records</span>
                                    <button class="btn btn-warning btn-sm" onclick="showResetProgressModal()">
                                        <i class="fas fa-book-open"></i> Reset
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="reset-category">
                            <h4><i class="fas fa-calendar-check"></i> Attendance Data</h4>
                            <div class="reset-items">
                                <div class="reset-item">
                                    <span class="reset-label">Reset Attendance History</span>
                                    <span class="reset-description">Clear all attendance records</span>
                                    <button class="btn btn-warning btn-sm" onclick="showResetAttendanceModal()">
                                        <i class="fas fa-calendar-times"></i> Reset
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="reset-category">
                            <h4><i class="fas fa-book"></i> Academic Data</h4>
                            <div class="reset-items">
                                <div class="reset-item">
                                    <span class="reset-label">Reset All Books</span>
                                    <span class="reset-description">Delete all books and their progress records</span>
                                    <button class="btn btn-warning btn-sm" onclick="showResetBooksModal()">
                                        <i class="fas fa-books"></i> Reset
                                    </button>
                                </div>
                                <div class="reset-item">
                                    <span class="reset-label">Reset Teacher Logs</span>
                                    <span class="reset-description">Delete all teacher logbook entries</span>
                                    <button class="btn btn-warning btn-sm" onclick="showResetLogsModal()">
                                        <i class="fas fa-clipboard-list"></i> Reset
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="reset-category">
                            <h4><i class="fas fa-users-cog"></i> System Data</h4>
                            <div class="reset-items">
                                <div class="reset-item">
                                    <span class="reset-label">Reset All Users</span>
                                    <span class="reset-description">Delete all user accounts except current admin</span>
                                    <button class="btn btn-warning btn-sm" onclick="showResetUsersModal()">
                                        <i class="fas fa-user-cog"></i> Reset
                                    </button>
                                </div>
                                <div class="reset-item">
                                    <span class="reset-label">Reset Settings</span>
                                    <span class="reset-description">Reset all application settings to default values</span>
                                    <button class="btn btn-warning btn-sm" onclick="showResetSettingsModal()">
                                        <i class="fas fa-cog"></i> Reset
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Complete Reset -->
                    <div class="danger-zone">
                        <h4><i class="fas fa-exclamation-triangle"></i> Complete Reset</h4>
                        <p class="help-text">This will delete ALL data and reset the entire application to its initial state. This action cannot be undone!</p>
                        <button class="btn btn-danger" onclick="showCompleteResetModal()">
                            <i class="fas fa-bomb"></i> Reset Everything
                        </button>
                    </div>
                    
                    <!-- Import/Export -->
                    <div class="setting-group" style="margin-top: 30px;">
                        <h4><i class="fas fa-exchange-alt"></i> Import / Export Data</h4>
                        <p class="help-text">Manage your data in bulk operations.</p>
                        <div class="reset-buttons">
                            <button class="btn btn-secondary" onclick="showBulkImport()">
                                <i class="fas fa-file-import"></i> Bulk Import Students
                            </button>
                            <button class="btn btn-secondary" onclick="downloadAllStudentsCSV()">
                                <i class="fas fa-file-export"></i> Export All Data
                            </button>
                            <button class="btn btn-secondary" onclick="showBackupModal()">
                                <i class="fas fa-download"></i> Create Backup
                            </button>
                        </div>
                    </div>

                    <!-- Bulk Import Section (Hidden by default) -->
                    <div id="bulkImportSection" class="bulk-import-section" style="display:none;">
                        <div class="bulk-import-header">
                            <h3>üìä Bulk Import Students from CSV</h3>
                            <button onclick="hideBulkImport()" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Back to Data Management
                            </button>
                        </div>
                        
                        <div class="bulk-import-instructions">
                            <h4>üìã File Format Required:</h4>
                            <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #2196f3;">
                                <p style="margin: 0; color: #1565c0; font-weight: 600;">
                                    üí° <strong>Important for Bengali/Unicode text:</strong> Save as <strong>CSV UTF-8</strong> format
                                </p>
                                <p style="margin: 5px 0 0 0; color: #1565c0; font-size: 0.9em;">
                                    <strong>Excel:</strong> File ‚Üí Save As ‚Üí Choose <strong>"CSV UTF-8 (Comma delimited) (*.csv)"</strong>
                                </p>
                                <p style="margin: 5px 0 0 0; color: #1565c0; font-size: 0.9em;">
                                    <strong>Google Sheets:</strong> File ‚Üí Download ‚Üí Comma-separated values (.csv)
                                </p>
                            </div>
                            <div style="background: #fff3cd; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #ffc107;">
                                <p style="margin: 0; color: #856404; font-weight: 600;">
                                    üî§ <strong>Bengali/Unicode Support:</strong> Your Bengali text will display correctly if saved as CSV UTF-8
                                </p>
                                <p style="margin: 8px 0 0 0; color: #856404; font-size: 0.9em;">
                                    <strong>Example:</strong> Name should look like "‡¶Æ‡ßã‡¶π‡¶æ‡¶Æ‡ßç‡¶Æ‡¶¶ ‡¶Ü‡¶≤‡ßÄ" not "√†¬¶¬Æ√†¬ß‚Äπ√†¬¶¬π√†¬¶¬æ√†¬¶¬Æ√†¬ß√†¬¶¬Æ√†¬¶¬¶ √†¬¶‚Ä†√†¬¶¬≤√†¬ß‚Ç¨"
                                </p>
                            </div>
                            
                            <div style="text-align: center; margin-bottom: 20px;">
                                <button onclick="downloadAllStudentsCSV()" class="btn btn-secondary">
                                    <i class="fas fa-download"></i> Download All Students Data
                                </button>
                            </div>
                            <div class="format-table">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>id</th>
                                            <th>name</th>
                                            <th>fatherName</th>
                                            <th>rollNumber</th>
                                            <th>mobileNumber</th>
                                            <th>district</th>
                                            <th>upazila</th>
                                            <th>class</th>
                                            <th>registrationDate</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>ST001</td>
                                            <td>Abdullah Rahman</td>
                                            <td>Rahman Ahmed</td>
                                            <td>101</td>
                                            <td>01711234567</td>
                                            <td>Dhaka</td>
                                            <td>Dhanmondi</td>
                                            <td>‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</td>
                                            <td>2025-01-01</td>
                                        </tr>
                                        <tr>
                                            <td>ST002</td>
                                            <td>Fatima Khatun</td>
                                            <td>Karim Uddin</td>
                                            <td>102</td>
                                            <td>01811234567</td>
                                            <td>Dhaka</td>
                                            <td>Gulshan</td>
                                            <td>‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</td>
                                            <td>2025-01-02</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="import-notes">
                                <p><strong>‚ö†Ô∏è Important:</strong></p>
                                <ul>
                                    <li>First row must be headers (exactly as shown above)</li>
                                    <li>All fields are required - no empty cells</li>
                                    <li>Students with same ID will be replaced/updated</li>
                                    <li>Roll numbers must be unique (except for updates)</li>
                                    <li>Class names must match your existing classes</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="bulk-import-upload">
                            <div class="upload-area">
                                <input type="file" id="excelFile" accept=".csv" style="display:none;">
                                <div class="upload-drop-zone" onclick="document.getElementById('excelFile').click()">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Click to select CSV file</p>
                                    <p class="file-types">Supports .csv files (Excel saved as CSV)</p>
                                </div>
                            </div>
                            <div class="upload-actions">
                                <button onclick="processExcelFile()" class="btn btn-primary" id="uploadBtn" disabled>
                                    <i class="fas fa-upload"></i> Upload & Import Students
                                </button>
                            </div>
                        </div>
                        
                        <div id="importResults" class="import-results" style="display:none;">
                            <!-- Import results will be shown here -->
                        </div>
                    </div>
                </div>

                <!-- User Management Tab -->
                <div id="users" class="tab-content">
                    <h3>User Account Management</h3>
                    
                    <div class="setting-group">
                        <label>Manage Users</label>
                        <p class="help-text">Create, edit, and delete user accounts for the system.</p>
                        
                        <div class="input-group">
                            <button class="btn btn-primary" onclick="showCreateUserModal()">
                                <i class="fas fa-user-plus"></i> Create New User
                            </button>
                            <button class="btn btn-secondary" onclick="refreshUsersList()">
                                <i class="fas fa-refresh"></i> Refresh List
                            </button>
                        </div>
                        
                        <div class="item-list" id="usersList" style="margin-top: 20px;">
                            <!-- Users will be displayed here -->
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label>Change Admin Password</label>
                        <p class="help-text">Update your admin account password for security.</p>
                        
                        <div class="password-change-form">
                            <div class="form-group">
                                <label for="currentPassword">Current Password</label>
                                <input type="password" id="currentPassword" placeholder="Enter current password">
                            </div>
                            
                            <div class="form-group">
                                <label for="newPassword">New Password</label>
                                <input type="password" id="newPassword" placeholder="Enter new password">
                            </div>
                            
                            <div class="form-group">
                                <label for="confirmPassword">Confirm New Password</label>
                                <input type="password" id="confirmPassword" placeholder="Confirm new password">
                            </div>
                            
                            <button class="btn btn-primary" onclick="changePassword()">
                                <i class="fas fa-key"></i> Change Password
                            </button>
                        </div>
                        
                        <div id="passwordMessage" style="margin-top: 15px; display: none;"></div>
                    </div>
                    
                    <div class="setting-group">
                        <label>Account Information</label>
                        <p class="help-text">Your current account details.</p>
                        <div id="accountInfo" style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            <p><strong>Username:</strong> <span id="accountUsername">-</span></p>
                            <p><strong>Role:</strong> <span id="accountRole">-</span></p>
                            <p><strong>Last Login:</strong> <span id="accountLastLogin">-</span></p>
                            <p><strong>Account Created:</strong> <span id="accountCreated">-</span></p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>
    </div> <!-- End of mainApp div -->

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 <span id="footerAppName">Loading...</span>. All rights reserved.</p>
        </div>
    </footer>
    
    </div> <!-- End of mainAppContent div -->

    <!-- Teachers Corner Modals -->
    <div id="log-modal" class="modal-backdrop justify-center items-center">
        <div class="modal-content bg-white rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3">
            <div class="p-6 border-b"><h3 id="log-modal-title" class="text-xl font-semibold text-gray-800"></h3></div>
            <div class="p-6 space-y-4">
                <input type="hidden" id="log-id"><input type="hidden" id="log-class-name">
                <div><label for="log-type" class="block text-sm font-medium text-gray-700 mb-1">‡¶®‡ßã‡¶ü‡ßá‡¶∞ ‡¶ß‡¶∞‡¶£</label><select id="log-type" class="w-full border-gray-300 rounded-md shadow-sm"><option value="‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶Æ‡ßÇ‡¶≤‡¶ï">‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶Æ‡ßÇ‡¶≤‡¶ï</option><option value="‡¶Ü‡¶ö‡¶∞‡¶£‡¶ó‡¶§">‡¶Ü‡¶ö‡¶∞‡¶£‡¶ó‡¶§</option><option value="‡¶™‡¶ø‡¶§‡¶æ‡¶Æ‡¶æ‡¶§‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó">‡¶™‡¶ø‡¶§‡¶æ‡¶Æ‡¶æ‡¶§‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó</option><option value="‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶ò‡¶ü‡¶®‡¶æ">‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶ò‡¶ü‡¶®‡¶æ</option><option value="‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£">‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£</option></select></div>
                <div><label for="log-student-select" class="block text-sm font-medium text-gray-700 mb-1">‡¶õ‡¶æ‡¶§‡ßç‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label><select id="log-student-select" class="w-full border-gray-300 rounded-md shadow-sm"><option value="">‡¶∏‡¶¨‡¶æ‡¶á (‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶≤‡¶ó)</option></select><input type="hidden" id="log-student-id"></div>
                <div class="flex items-center gap-4">
                    <label class="flex items-center gap-2">
                        <input type="checkbox" id="log-important" class="rounded">
                        <span class="text-sm font-medium text-gray-700">‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£</span>
                    </label>
                    <label class="flex items-center gap-2">
                        <input type="checkbox" id="log-followup" class="rounded">
                        <span class="text-sm font-medium text-gray-700">‡¶Ö‡¶®‡ßÅ‡¶∏‡¶∞‡¶£ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®</span>
                    </label>
                </div>
                <div><label for="log-details" class="block text-sm font-medium text-gray-700 mb-1">‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</label><textarea id="log-details" rows="4" class="w-full border-gray-300 rounded-md shadow-sm" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶®‡ßã‡¶ü ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea></div>
            </div>
            <div class="px-6 py-4 bg-gray-50 flex justify-end gap-3"><button onclick="closeLogModal()" class="btn-secondary text-white px-4 py-2 rounded-md">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button><button onclick="saveLogEntry()" class="btn-primary text-white px-4 py-2 rounded-md">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button></div>
        </div>
    </div>
    <div id="student-profile-modal" class="modal-backdrop justify-center items-center">
        <div class="modal-content bg-white rounded-lg shadow-xl w-11/12 md:w-4/5 lg:w-3/4 xl:w-2/3">
             <div class="p-6 border-b flex justify-between items-center">
                <h3 id="student-profile-title" class="text-xl font-semibold text-gray-800"></h3>
                <div>
                    <button onclick="printStudentDetail(getCurrentStudentId())" class="text-gray-600 hover:text-blue-500 text-sm font-semibold flex items-center gap-2 mr-4"><i class="fas fa-print"></i> ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü</button>
                    <button onclick="closeStudentProfileModal()" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
                </div>
            </div>
            <div id="student-profile-content" class="p-6 max-h-[80vh] overflow-y-auto"></div>
        </div>
    </div>
    <div id="book-modal" class="modal-backdrop justify-center items-center">
        <div class="modal-content bg-white rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3">
            <div class="p-6 border-b"><h3 id="book-modal-title" class="text-xl font-semibold text-gray-800"></h3></div>
            <div class="p-6 space-y-4">
                <input type="hidden" id="book-id">
                <div><label for="book-name" class="block text-sm font-medium text-gray-700 mb-1">‡¶¨‡¶á‡ßü‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="book-name" class="w-full border-gray-300 rounded-md shadow-sm"></div>
                <div><label for="book-total-pages" class="block text-sm font-medium text-gray-700 mb-1">‡¶Æ‡ßã‡¶ü ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ</label><input type="number" id="book-total-pages" class="w-full border-gray-300 rounded-md shadow-sm"></div>
                <div id="book-progress-section">
                    <label for="book-completed-pages" class="block text-sm font-medium text-gray-700 mb-1">‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ</label>
                    <input type="number" id="book-completed-pages" class="w-full border-gray-300 rounded-md shadow-sm">
                    <label for="book-progress-note" class="block text-sm font-medium text-gray-700 mb-1 mt-2">‡¶®‡ßã‡¶ü (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
                    <textarea id="book-progress-note" rows="2" class="w-full border-gray-300 rounded-md shadow-sm" placeholder="‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø‡¶∞ ‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º‡ßá ‡¶®‡ßã‡¶ü ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
                </div>
                <div id="book-progress-history-section" class="pt-4 border-t">
                    <h4 class="text-sm font-semibold text-gray-600 mb-2">‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h4>
                    <div id="progress-history-list" class="text-xs text-gray-500 max-h-24 overflow-y-auto space-y-1"></div>
                </div>
            </div>
            <div class="px-6 py-4 bg-gray-50 flex justify-between items-center">
                <button id="delete-book-btn" onclick="deleteBook()" class="btn-danger text-white px-4 py-2 rounded-md">‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®</button>
                <div>
                    <button onclick="closeBookModal()" class="btn-secondary text-white px-4 py-2 rounded-md">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                    <button onclick="saveBook()" class="btn-primary text-white px-4 py-2 rounded-md">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                </div>
            </div>
        </div>
    </div>
    <div id="score-modal" class="modal-backdrop justify-center items-center">
        <div class="modal-content bg-white rounded-lg shadow-xl w-11/12 md:w-1/2">
            <div class="p-6 border-b"><h3 id="score-modal-title" class="text-xl font-semibold text-gray-800">‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3></div>
            <div class="p-6 space-y-4">
                <input type="hidden" id="score-student-id">
                <div>
                    <label for="new-score" class="block text-sm font-medium text-gray-700 mb-1">‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ (‡ß¶-‡ßß‡ß¶‡ß¶)</label>
                    <input type="number" id="new-score" min="0" max="100" class="w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label for="score-change-reason" class="block text-sm font-medium text-gray-700 mb-1">‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
                    <textarea id="score-change-reason" rows="3" class="w-full border-gray-300 rounded-md shadow-sm" placeholder="‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
                </div>
            </div>
            <div class="px-6 py-4 bg-gray-50 flex justify-end gap-3">
                <button onclick="closeScoreModal()" class="btn-secondary text-white px-4 py-2 rounded-md">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                <button onclick="saveNewScore()" class="btn-primary text-white px-4 py-2 rounded-md">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
            </div>
        </div>
    </div>
    
    <!-- Inactive Students Modal -->
    <div id="inactive-students-modal" class="modal-backdrop justify-center items-center">
        <div class="modal-content bg-white rounded-lg shadow-xl w-11/12 md:w-3/4 lg:w-2/3">
            <div class="p-6 border-b flex justify-between items-center">
                <h3 class="text-xl font-semibold text-gray-800">‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
                <button onclick="closeInactiveStudentsModal()" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <p class="text-gray-600 text-sm">‡¶è‡¶á ‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡¶∞‡¶æ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º ‡¶∞‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶§‡¶æ‡¶¶‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§</p>
                </div>
                <div id="inactive-students-list" class="space-y-3">
                    <!-- Inactive students will be loaded here -->
                </div>
            </div>
        </div>
    </div>
    

    

    <!-- Modal for notifications -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- Bulk Absent Modal -->
    <div id="bulkAbsentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeBulkAbsentModal()">&times;</span>
            <h3>Mark All Students Absent</h3>
            <div class="bulk-absent-form">
                <label for="bulkAbsentReason">Reason for absence (applies to all students):</label>
                <input type="text" id="bulkAbsentReason" placeholder="e.g., School holiday, Strike, etc." maxlength="100">
                <div class="modal-buttons">
                    <button onclick="confirmMarkAllAbsent()" class="btn btn-danger">
                        <i class="fas fa-times-circle"></i> Mark All Absent
                    </button>
                    <button onclick="closeBulkAbsentModal()" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reset Attendance Modal -->
    <div id="resetAttendanceModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeResetAttendanceModal()">&times;</span>
            <h3 style="color: #dc3545;"><i class="fas fa-exclamation-triangle"></i> Reset Attendance History</h3>
            <div class="reset-attendance-form">
                <div style="background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 6px; padding: 15px; margin-bottom: 20px;">
                    <p style="color: #721c24; margin-bottom: 10px;"><strong>‚ö†Ô∏è Warning: This action cannot be undone!</strong></p>
                    <p style="color: #721c24; margin-bottom: 10px;">This will permanently delete:</p>
                    <ul style="color: #721c24; margin-bottom: 0;">
                        <li>All attendance records for all students</li>
                        <li>All saved attendance dates</li>
                        <li>All attendance history from the calendar</li>
                    </ul>
                </div>
                <p style="margin-bottom: 15px;">Type <strong>"RESET"</strong> to confirm:</p>
                <input type="text" id="resetConfirmationInput" placeholder="Type RESET to confirm" style="margin-bottom: 15px; width: 100%;">
                <div class="modal-buttons">
                    <button onclick="confirmResetAttendance()" class="btn btn-danger" id="confirmResetBtn" disabled>
                        <i class="fas fa-trash-alt"></i> Reset All Attendance
                    </button>
                    <button onclick="closeResetAttendanceModal()" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Book Management Edit Modal -->
    <div id="bookManagementEditModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Book</h3>
                <button type="button" onclick="closeBookManagementEditModal()" class="btn btn-secondary btn-small">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="bookManagementEditForm" class="form">
                <input type="hidden" id="bookManagementEditId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="bookManagementEditName">Book Name *</label>
                        <input type="text" id="bookManagementEditName" required>
                    </div>
                    <div class="form-group">
                        <label for="editBookClass">Class</label>
                        <select id="editBookClass">
                            <option value="">All Classes</option>
                            <!-- Class options will be populated dynamically from database -->
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editBookTotalPages">Total Pages</label>
                        <input type="number" id="editBookTotalPages" min="1" placeholder="Enter total pages">
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                    <button type="button" onclick="closeBookManagementEditModal()" class="btn btn-secondary">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create User Modal -->
    <div id="createUserModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New User</h3>
                <button type="button" onclick="closeCreateUserModal()" class="btn btn-secondary btn-small">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="createUserForm" class="form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="createUsername">Username *</label>
                        <input type="text" id="createUsername" required placeholder="Enter username">
                    </div>
                    <div class="form-group">
                        <label for="createPassword">Password *</label>
                        <input type="password" id="createPassword" required placeholder="Enter password">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="createRole">Role *</label>
                        <select id="createRole" required>
                            <option value="">Select Role</option>
                            <option value="admin">Admin</option>
                            <option value="user">User</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="createUserClass">Assigned Class</label>
                        <select id="createUserClass">
                            <option value="">No Class (Admin Access)</option>
                            <!-- Class options will be populated dynamically -->
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i> Create User
                    </button>
                    <button type="button" onclick="closeCreateUserModal()" class="btn btn-secondary">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="editUserModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit User</h3>
                <button type="button" onclick="closeEditUserModal()" class="btn btn-secondary btn-small">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="editUserForm" class="form">
                <input type="hidden" id="editUserId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="editUsername">Username *</label>
                        <input type="text" id="editUsername" required placeholder="Enter username">
                    </div>
                    <div class="form-group">
                        <label for="editRole">Role *</label>
                        <select id="editRole" required>
                            <option value="admin">Admin</option>
                            <option value="user">User</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editUserClass">Assigned Class</label>
                        <select id="editUserClass">
                            <option value="">No Class (Admin Access)</option>
                            <!-- Class options will be populated dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editUserStatus">Status</label>
                        <select id="editUserStatus" required>
                            <option value="1">Active</option>
                            <option value="0">Inactive</option>
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Update User
                    </button>
                    <button type="button" onclick="resetUserPassword()" class="btn btn-warning">
                        <i class="fas fa-key"></i> Reset Password
                    </button>
                    <button type="button" onclick="closeEditUserModal()" class="btn btn-secondary">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
    


    <script src="teachers-corner.js"></script>
    <script type="module" src="translations.js"></script>
    <script src="modules/hijri.js" type="module"></script>
    <script type="module" src="modules/main.js"></script>
    
    <script>
        // Authentication check and logout functionality
        let currentUser = null;
        
        // Check authentication on page load
        async function checkAuthentication() {
            try {
                const response = await fetch('/api/auth/user');
                if (response.ok) {
                    currentUser = await response.json();
                    window.currentUser = currentUser;  // Make it globally accessible
                    // Use fallback text initially, will be updated by translation system
                    const welcomeText = window.t ? window.t('welcome') : 'Welcome';
                    document.getElementById('currentUser').textContent = `${welcomeText}, ${currentUser.username}`;
                    
                    // Apply role-based UI restrictions
                    applyRoleBasedUI(currentUser);
                } else {
                    // Not authenticated, redirect to login
                    // Hide loading screen before redirect
                    hideLoadingScreen();
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 200);
                }
            } catch (error) {
                // Network error, redirect to login
                // Hide loading screen before redirect
                hideLoadingScreen();
                setTimeout(() => {
                    window.location.href = '/';
                }, 200);
            }
        }
        
        // Apply role-based UI restrictions
        function applyRoleBasedUI(user) {
            if (user.role === 'user') {
                // Add user-role class to body for CSS restrictions
                document.body.classList.add('user-role');
                
                // Hide all sections initially
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Show Teachers Corner section
                const teachersCornerSection = document.getElementById('teachers-corner-section');
                if (teachersCornerSection) {
                    teachersCornerSection.classList.add('active');
                }
                
                // For regular users, automatically show Teachers Corner for their assigned class
                if (user.class_name) {
                    setTimeout(() => {
                        openTeachersCornerForClass(user.class_name);
                    }, 300);
                }
            } else if (user.role === 'admin') {
                // Remove user-role class if it exists (for admin users)
                document.body.classList.remove('user-role');
                
                // Show dashboard for admin users
                const dashboardSection = document.getElementById('dashboard');
                if (dashboardSection) {
                    dashboardSection.classList.add('active');
                }
                
                // Add active class to dashboard nav link
                const dashboardNavLink = document.querySelector('a[onclick*="dashboard"]');
                if (dashboardNavLink) {
                    dashboardNavLink.classList.add('active');
                }
            }
            
            // Hide loading screen and show main app content
            hideLoadingScreen();
        }
        
        // Function to hide loading screen and show main app
        function hideLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            const mainAppContent = document.getElementById('mainAppContent');
            
            if (loadingScreen && mainAppContent) {
                // Fade out loading screen
                loadingScreen.style.transition = 'opacity 0.3s ease-out';
                loadingScreen.style.opacity = '0';
                
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    mainAppContent.style.display = 'block';
                    
                    // Fade in main app
                    mainAppContent.style.opacity = '0';
                    mainAppContent.style.transition = 'opacity 0.3s ease-in';
                    setTimeout(() => {
                        mainAppContent.style.opacity = '1';
                    }, 50);
                }, 300);
            }
        }
        
        // Logout function
        async function logout() {
            try {
                const response = await fetch('/api/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    // Redirect to login page
                    window.location.href = '/';
                } else {
                    alert('Logout failed. Please try again.');
                }
            } catch (error) {
                alert('Network error during logout. Please try again.');
            }
        }
        
        // Check authentication when page loads
        window.addEventListener('load', checkAuthentication);
        
        // Load account information when user management tab is opened
        async function loadAccountInfo() {
            try {
                const response = await fetch('/api/auth/user');
                if (response.ok) {
                    const user = await response.json();
                    
                    document.getElementById('accountUsername').textContent = user.username;
                    document.getElementById('accountRole').textContent = user.role;
                    document.getElementById('accountLastLogin').textContent = user.last_login ? new Date(user.last_login).toLocaleString() : 'Never';
                    document.getElementById('accountCreated').textContent = user.created_at ? new Date(user.created_at).toLocaleString() : 'Unknown';
                }
            } catch (error) {
                console.error('Error loading account info:', error);
            }
        }
        
        // Change password function
        async function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const messageDiv = document.getElementById('passwordMessage');
            
            // Clear previous message
            messageDiv.style.display = 'none';
            
            // Validation
            if (!currentPassword || !newPassword || !confirmPassword) {
                showPasswordMessage('Please fill in all fields.', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showPasswordMessage('New passwords do not match.', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showPasswordMessage('New password must be at least 6 characters long.', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/auth/change-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        currentPassword: currentPassword,
                        newPassword: newPassword
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showPasswordMessage(data.message, 'success');
                    // Clear form
                    document.getElementById('currentPassword').value = '';
                    document.getElementById('newPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                } else {
                    showPasswordMessage(data.error, 'error');
                }
            } catch (error) {
                showPasswordMessage('Network error. Please try again.', 'error');
            }
        }
        
        // Show password change message
        function showPasswordMessage(message, type) {
            const messageDiv = document.getElementById('passwordMessage');
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
            
            if (type === 'success') {
                messageDiv.style.background = '#d4edda';
                messageDiv.style.color = '#155724';
                messageDiv.style.border = '1px solid #c3e6cb';
            } else {
                messageDiv.style.background = '#f8d7da';
                messageDiv.style.color = '#721c24';
                messageDiv.style.border = '1px solid #f5c6cb';
            }
            
            messageDiv.style.padding = '10px';
            messageDiv.style.borderRadius = '5px';
            messageDiv.style.marginTop = '15px';
        }
        
        // Override the openSettingsTab function to load account info when users tab is opened
        const originalOpenSettingsTab = window.openSettingsTab;
        window.openSettingsTab = function(event, tabName) {
            originalOpenSettingsTab(event, tabName);
            if (tabName === 'users') {
                loadAccountInfo();
            }
        };
    </script>
</body>
</html>
