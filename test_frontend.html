<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Management Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .book-item { border: 1px solid #ccc; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .book-info h4 { margin: 0 0 5px 0; }
        .book-class { color: #666; font-size: 14px; }
        .book-actions { margin-top: 10px; }
        .btn { padding: 5px 10px; margin-right: 5px; border: none; border-radius: 3px; cursor: pointer; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .no-data { color: #666; font-style: italic; }
    </style>
</head>
<body>
    <h1>Book Management Test</h1>
    
    <h2>Add New Book</h2>
    <div>
        <input type="text" id="newBookName" placeholder="Enter book name">
        <select id="newBookClass">
            <option value="">All Classes</option>
            <option value="1">প্রথম শ্রেণি</option>
            <option value="2">দ্বিতীয় শ্রেণি</option>
            <option value="3">তৃতীয় শ্রেণি</option>
            <option value="4">চতুর্থ শ্রেণি</option>
            <option value="5">পঞ্চম শ্রেণি</option>
        </select>
        <button onclick="addBook()">Add Book</button>
    </div>
    
    <h2>Books List</h2>
    <div id="settingsBooksList">
        <!-- Books will be displayed here -->
    </div>
    
    <script>
        let books = [];
        
        async function loadBooks() {
            try {
                console.log('Loading books...');
                const response = await fetch('/api/books');
                console.log('Response status:', response.status);
                
                if (response.ok) {
                    books = await response.json();
                    console.log('Books loaded:', books);
                    displayBooks();
                } else {
                    console.error('Failed to load books, status:', response.status);
                }
            } catch (error) {
                console.error('Error loading books:', error);
            }
        }
        
        function displayBooks() {
            const settingsBooksList = document.getElementById('settingsBooksList');
            if (settingsBooksList) {
                console.log('Displaying books in settings:', books);
                console.log('Books count:', books.length);
                
                if (books.length === 0) {
                    settingsBooksList.innerHTML = '<p class="no-data">No books added yet. Add your first book above.</p>';
                } else {
                    settingsBooksList.innerHTML = books.map(book => `
                        <div class="book-item" data-book-id="${book.id}">
                            <div class="book-info">
                                <h4>${book.book_name}</h4>
                                <p class="book-class">${book.class_id ? getClassNameById(book.class_id) : 'All Classes'}</p>
                            </div>
                            <div class="book-actions">
                                <button onclick="editBook(${book.id})" class="btn btn-secondary">
                                    Edit
                                </button>
                                <button onclick="deleteBook(${book.id})" class="btn btn-danger">
                                    Delete
                                </button>
                            </div>
                        </div>
                    `).join('');
                }
            } else {
                console.error('settingsBooksList element not found');
            }
        }
        
        function getClassNameById(classId) {
            const classMap = {
                1: 'প্রথম শ্রেণি',
                2: 'দ্বিতীয় শ্রেণি',
                3: 'তৃতীয় শ্রেণি',
                4: 'চতুর্থ শ্রেণি',
                5: 'পঞ্চম শ্রেণি'
            };
            return classMap[classId] || 'Unknown Class';
        }
        
        async function addBook() {
            const bookName = document.getElementById('newBookName').value.trim();
            const classId = document.getElementById('newBookClass').value || null;
            
            if (!bookName) {
                alert('Please enter a book name');
                return;
            }
            
            try {
                const response = await fetch('/api/books', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        book_name: bookName,
                        class_id: classId
                    })
                });
                
                if (response.ok) {
                    alert('Book added successfully');
                    document.getElementById('newBookName').value = '';
                    document.getElementById('newBookClass').value = '';
                    await loadBooks();
                } else {
                    const error = await response.json();
                    alert(error.error || 'Failed to add book');
                }
            } catch (error) {
                console.error('Error adding book:', error);
                alert('Failed to add book');
            }
        }
        
        async function editBook(bookId) {
            const book = books.find(b => b.id === bookId);
            if (!book) return;
            
            const newName = prompt('Enter new book name:', book.book_name);
            if (!newName) return;
            
            try {
                const response = await fetch(`/api/books/${bookId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        book_name: newName,
                        class_id: book.class_id
                    })
                });
                
                if (response.ok) {
                    alert('Book updated successfully');
                    await loadBooks();
                } else {
                    const error = await response.json();
                    alert(error.error || 'Failed to update book');
                }
            } catch (error) {
                console.error('Error updating book:', error);
                alert('Failed to update book');
            }
        }
        
        async function deleteBook(bookId) {
            const confirmed = confirm('Are you sure you want to delete this book? This action cannot be undone.');
            if (!confirmed) return;
            
            try {
                const response = await fetch(`/api/books/${bookId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('Book deleted successfully');
                    await loadBooks();
                } else {
                    const error = await response.json();
                    alert(error.error || 'Failed to delete book');
                }
            } catch (error) {
                console.error('Error deleting book:', error);
                alert('Failed to delete book');
            }
        }
        
        // Load books when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadBooks();
        });
    </script>
</body>
</html> 